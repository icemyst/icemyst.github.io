const e="7.3.0";importScripts(`https://storage.googleapis.com/workbox-cdn/releases/${e}/workbox-sw.js`);const t="icemystCache",o="icemystCacheTime",s=3e3,a=5e3,n=8e3;workbox.core.setCacheNameDetails({prefix:"冰梦",suffix:e}),workbox.core.skipWaiting(),workbox.core.clientsClaim(),workbox.precaching.precacheAndRoute([{revision:"666a4d09e6ae30ba1002fbda20266bc8",url:"./404.html"},{revision:"b4f8c8a7639b607de8dd4139339bb1cf",url:"./index.html"},{revision:"bb0916138fa9e27cd61f8bbe8391dd03",url:"./css/index.css"},{revision:"1925c9f5dd8100a7bb63c8e80a7cb429",url:"./js/main.js"},{revision:"0ac19d7bef5e9a5bfe13df7affdb2692",url:"./manifest.json"}],{directoryIndex:null}),workbox.precaching.cleanupOutdatedCaches();const i=(e,t=500,o=604800)=>({cacheName:e,plugins:[new workbox.expiration.ExpirationPlugin({maxEntries:t,maxAgeSeconds:o,purgeOnQuotaError:!0}),new workbox.cacheableResponse.CacheableResponsePlugin({statuses:[0,200]}),new workbox.rangeRequests.RangeRequestsPlugin]});[{pattern:/\.(?:png|jpg|jpeg|gif|bmp|webp|svg|ico)$/,strategy:"StaleWhileRevalidate",config:i("images",200,2592e3)},{pattern:/\.(?:eot|ttf|woff|woff2)$/,strategy:"StaleWhileRevalidate",config:i("fonts",50,2592e3)},{pattern:/^https:\/\/fonts\.googleapis\.com/,strategy:"StaleWhileRevalidate",config:{cacheName:"google-fonts-stylesheets",plugins:[new workbox.expiration.ExpirationPlugin({maxEntries:20,maxAgeSeconds:2592e3})]}},{pattern:/^https:\/\/fonts\.gstatic\.com/,config:i("google-fonts-webfonts")},{pattern:/^https:\/\/cdn\.jsdelivr\.net/,config:i("static-libs")}].forEach((({pattern:e,strategy:t="CacheFirst",config:o})=>{workbox.routing.registerRoute(e,new workbox.strategies[t](o))})),workbox.routing.registerRoute(/\/api\//,new workbox.strategies.NetworkFirst({cacheName:"api-cache",plugins:[new workbox.expiration.ExpirationPlugin({maxEntries:50,maxAgeSeconds:3600}),new workbox.cacheableResponse.CacheableResponsePlugin({statuses:[0,200]})]})),workbox.googleAnalytics.initialize();const c=()=>(new Date).getTime(),r=(e,t)=>new Request(`https://${e}/${encodeURIComponent(t)}`),l={handleError:(e,t)=>null,read:async e=>{try{const t=await caches.match(e);return t?await t.text():null}catch(e){return l.handleError("read",e)}},write:async(e,t)=>{try{const s=await caches.open(o);await s.put(e,new Response(t))}catch(e){l.handleError("write",e)}},delete:async e=>{try{if(await caches.match(e)){const t=await caches.open(o);await t.delete(e)}}catch(e){l.handleError("delete",e)}}},w=e=>l.read(r("LOCALCACHE",e)),f=(e,t)=>l.write(r("LOCALCACHE",e),t),m=e=>l.write(r("ACCESS-CACHE",e),c()),g=new Map([["jsdelivr",{source:["//cdn.jsdelivr.net/gh"],dist:"//cdn1.tianli0.top/gh"}],["npm",{source:["//cdn.jsdelivr.net/npm"],dist:"//npm.elemecdn.com"}],["googlefonts",{source:["//fonts.googleapis.com"],dist:"//fonts.loli.net"}],["googlestatic",{source:["//fonts.gstatic.com"],dist:"//gstatic.loli.net"}],["gravatar",{source:["//www.gravatar.com/avatar"],dist:"//gravatar.loli.net/avatar"}],["smms",{source:["//s2.loli.net"],dist:"//image.baidu.com/search/down?url=https://s2.loli.net"}],["imgur",{source:["//i.imgur.com"],dist:"//proxy.thiscdn.com/i.imgur.com"}],["imagekit",{source:["//ik.imagekit.io"],dist:"//proxy.thiscdn.com/ik.imagekit.io"}],["Github",{source:["//raw.githubusercontent.com"],dist:"//raw.gitmirror.com"}]]),d={static:{clean:!1,time:604800,match:e=>{const t=e.pathname;return t.match(/\.(woff2|woff|ttf|cur)$/)||t.match(/\/(pjax\.min|fancybox\.umd\.min|twikoo\.all\.min)\.js$/)||t.match(/\/(all\.min|fancybox\.min)\.css/)}},images:{clean:!1,time:2592e3,match:e=>e.pathname.match(/\.(png|jpg|jpeg|gif|bmp|webp|svg|ico)$/i)&&e.hostname.match(/(thiscdn\.com|baidu\.com|loli\.net)$/)}};self.addEventListener("install",(()=>self.skipWaiting())),self.addEventListener("fetch",(async e=>{if("GET"===e.request.method)try{const o=(e=>{const t=e.url;for(const[,o]of g){const s=o.source.find((e=>t.includes(e)));if(s)return new Request(t.replace(s,o.dist),{method:e.method,headers:e.headers,mode:e.mode,credentials:e.credentials,redirect:e.redirect})}return null})(e.request),i=o||e.request,r=(e=>{try{const t=new URL(e);return Object.values(d).find((e=>e.match?.(t)))||null}catch(e){return null}})(i.url),l=(i.url.match(/\.(png|jpg|jpeg|gif|bmp|webp|svg|ico)$/i),i.url.match(/\.(eot|ttf|woff|woff2)$/i));r?e.respondWith(caches.match(i).then((e=>(async(e,o,i)=>{const r=c();await m(e.url);const l=1e3*i.time,g=e.url.match(/\.(png|jpg|jpeg|gif|bmp|webp|svg|ico)$/i),d=e.url.match(/\.(eot|ttf|woff|woff2)$/i);let p=s;if(g&&(p=a),d&&(p=n),o){const t=await w(e.url);if(t&&r-t<l)return o}const u=async()=>{try{const o=await fetch(e);if((o.ok||0===o.status)&&"GET"===e.method){await f(e.url,""+r);const s=o.clone(),a=await caches.open(t);await a.put(e,s)}return o}catch(e){throw e}};return o?Promise.race([new Promise((e=>setTimeout((()=>e(o)),p))),u().catch((()=>o))]):Promise.race([u(),new Promise(((e,t)=>setTimeout((()=>t(Error("请求超时"))),p)))]).catch((e=>d?new Response("字体加载失败",{status:408,headers:{"Content-Type":"text/plain","Cache-Control":"no-store"}}):new Response("资源加载失败",{status:408})))})(i,e,r))).catch((e=>l?fetch(i).catch((()=>new Response("字体加载失败",{status:408,headers:{"Content-Type":"text/plain","Cache-Control":"no-store"}}))):fetch(i)))):o&&e.respondWith(fetch(i))}catch(e){}}));