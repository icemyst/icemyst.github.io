(()=>{const n=window.crypto||window.msCrypto,e=window.localStorage,t="hexo-blog-encrypt:#"+window.location.pathname,r=y("hexo-blog-encrypt的作者们都是大帅比!"),o=y("hexo-blog-encrypt是地表最强Hexo加密插件!"),i="<hbe-prefix></hbe-prefix>",c=document.getElementById("hexo-blog-encrypt"),a=c.dataset.wpm,u=c.dataset.whm,s=c.getElementsByTagName("script").hbeData,w=s.innerText,d=s.dataset.hmacdigest;function f(n){return new Uint8Array(n.match(/[\da-f]{2}/gi).map((n=>parseInt(n,16))))}function y(n){for(var e=n.length,t=0,r=[],o=0;o<e;){var i=n.codePointAt(o);i<128?(r[t++]=i,o++):i>127&&i<2048?(r[t++]=i>>6|192,r[t++]=63&i|128,o++):i>2047&&i<65536?(r[t++]=i>>12|224,r[t++]=i>>6&63|128,r[t++]=63&i|128,o++):(r[t++]=i>>18|240,r[t++]=i>>12&63|128,r[t++]=i>>6&63|128,r[t++]=63&i|128,o+=2)}return new Uint8Array(r)}function h(n){if("object"!=typeof n||null===n||"number"!=typeof n.byteLength)throw new TypeError("Expected input to be an ArrayBuffer");for(var e,t=new Uint8Array(n),r="",o=0;o<t.length;o++)r+=1===(e=t[o].toString(16)).length?"0"+e:e;return r}async function l(n){let e=document.createElement("div");return e.innerHTML=n,e.querySelectorAll("script").forEach((async n=>{n.replaceWith(await async function(n){let e=document.createElement("script");return["type","text","src","crossorigin","defer","referrerpolicy"].forEach((t=>{n[t]&&(e[t]=n[t])})),e}(n))})),e}async function p(e,r,o){let c=f(w);return await n.subtle.decrypt({name:"AES-CBC",iv:r},e,c.buffer).then((async e=>{const r=(new TextDecoder).decode(e);if(!r.startsWith(i))throw"Decode successfully but not start with KnownPrefix.";const c=document.createElement("button");c.textContent="Encrypt again",c.type="button",c.classList.add("hbe-button"),c.addEventListener("click",(()=>{window.localStorage.removeItem(t),window.location.reload()})),document.getElementById("hexo-blog-encrypt").style.display="inline",document.getElementById("hexo-blog-encrypt").innerHTML="",document.getElementById("hexo-blog-encrypt").appendChild(await l(r)),document.getElementById("hexo-blog-encrypt").appendChild(c),document.querySelectorAll("img").forEach((n=>{n.getAttribute("data-src")&&!n.src&&(n.src=n.getAttribute("data-src"))})),window.NexT&&NexT.boot&&"function"==typeof NexT.boot.refresh&&NexT.boot.refresh();var a=document.getElementById("toc-div");a&&(a.style.display="inline");var s=document.getElementsByClassName("toc-div-class");if(s&&s.length>0)for(var w=0;w<s.length;w++)s[w].style.display="inline";var y=new Event("hexo-blog-decrypt");return window.dispatchEvent(y),await async function(e,t){const r=(new TextEncoder).encode(t);let o=f(d);const i=await n.subtle.verify({name:"HMAC",hash:"SHA-256"},e,o,r);return i||alert(u),i}(o,r)})).catch((n=>(alert(a),!1)))}!function(){const i=JSON.parse(e.getItem(t));if(i){const r=f(i.iv).buffer,o=i.hmk;n.subtle.importKey("jwk",i.dk,{name:"AES-CBC",length:256},!0,["decrypt"]).then((i=>{n.subtle.importKey("jwk",o,{name:"HMAC",hash:"SHA-256",length:256},!0,["verify"]).then((n=>{p(i,r,n).then((n=>{n||e.removeItem(t)}))}))}))}c.addEventListener("keydown",(async i=>{if(i.isComposing||13===i.keyCode){const i=document.getElementById("hbePass").value,c=await function(e){let t=new TextEncoder;return n.subtle.importKey("raw",t.encode(e),{name:"PBKDF2"},!1,["deriveKey","deriveBits"])}(i),a=await function(e){return n.subtle.deriveKey({name:"PBKDF2",hash:"SHA-256",salt:r.buffer,iterations:1024},e,{name:"HMAC",hash:"SHA-256",length:256},!0,["verify"])}(c),u=await function(e){return n.subtle.deriveKey({name:"PBKDF2",hash:"SHA-256",salt:r.buffer,iterations:1024},e,{name:"AES-CBC",length:256},!0,["decrypt"])}(c),s=await function(e){return n.subtle.deriveBits({name:"PBKDF2",hash:"SHA-256",salt:o.buffer,iterations:512},e,128)}(c);p(u,s,a).then((r=>{r&&n.subtle.exportKey("jwk",u).then((r=>{n.subtle.exportKey("jwk",a).then((n=>{const o={dk:r,iv:h(s),hmk:n};e.setItem(t,JSON.stringify(o))}))}))}))}}))}()})();