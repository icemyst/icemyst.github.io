var t={init:function(){t.Drawing.init(".canvas"),document.body.classList.add(".personalities"),t.UI.simulate("I'm|冰梦|welcome to|visit my blog|#countdown 3"),t.Drawing.loop((function(){t.Shape.render()}))}};t.Drawing=function(){var n,i,e,h=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)};return{init:function(e){n=document.querySelector(e),i=n.getContext("2d"),this.adjustCanvas(),window.addEventListener("resize",(function(n){t.Drawing.adjustCanvas()}))},loop:function(t){e=e||t,this.clearFrame(),e(),h.call(window,this.loop.bind(this))},adjustCanvas:function(){n.width=window.innerWidth-100,n.height=window.innerHeight-30},clearFrame:function(){i.clearRect(0,0,n.width,n.height)},getArea:function(){return{w:n.width,h:n.height}},drawCircle:function(t,n){i.fillStyle=n.render(),i.beginPath(),i.arc(t.x,t.y,t.z,0,2*Math.PI,!0),i.closePath(),i.fill()}}}(),t.UI=function(){var n,i,e,h=30,a=[],s="#";function r(t){var n;return t.getHours()+":"+(n=(n=t.getMinutes())<10?"0"+n:n)}function o(t,e,h,a){clearInterval(n),t(i=a?h:1),(!h||!a&&i<h||a&&i>0)&&(n=setInterval((function(){t(i=a?i-1:i+1),(!a&&h&&i===h||a&&0===i)&&clearInterval(n)}),e))}function c(n){var i,u;o((function(f){switch(u=a.shift(),i=function(t){return(t=t&&t.split(" ")[0])&&t[0]===s&&t.substring(1)}(u),n=function(t){return t&&t.split(" ")[1]}(u),i){case"countdown":o((function(n){0===n?0===a.length?(t.Shape.switchShape(t.ShapeBuilder.letter("")),document.getElementById("stage").style.transform="scale(1,1)"):c(a):t.Shape.switchShape(t.ShapeBuilder.letter(n),!0)}),1e3,n=(n=parseInt(n)||10)>0?n:10,!0);break;case"rectangle":n=n&&n.split("x"),t.Shape.switchShape(t.ShapeBuilder.rectangle(Math.min(h,parseInt((n=n&&2===n.length?n:[h,15])[0])),Math.min(h,parseInt(n[1]))));break;case"circle":t.Shape.switchShape(t.ShapeBuilder.circle(n=Math.min(n=parseInt(n)||h,h)));break;case"time":var w=r(new Date);a.length>0?t.Shape.switchShape(t.ShapeBuilder.letter(w)):o((function(){(w=r(new Date))!==e&&t.Shape.switchShape(t.ShapeBuilder.letter(e=w))}),1e3);break;default:t.Shape.switchShape(t.ShapeBuilder.letter(u[0]===s?"HacPai":u))}}),2e3,(a="object"==typeof n?n:a.concat(n.split("|"))).length)}return{simulate:function(t){c(t)}}}(),t.Point=function(t){this.x=t.x,this.y=t.y,this.z=t.z,this.a=t.a,this.h=t.h},t.Color=function(t,n,i,e){this.r=t,this.g=n,this.b=i,this.a=e},t.Color.prototype={render:function(){return"rgba("+this.r+","+ +this.g+","+this.b+","+this.a+")"}},t.Dot=function(n,i){this.p=new t.Point({x:n,y:i,z:5,a:1,h:0}),this.e=.07,this.s=!0,this.c=new t.Color(255,255,255,this.p.a),this.t=this.clone(),this.q=[]},t.Dot.prototype={clone:function(){return new t.Point({x:this.x,y:this.y,z:this.z,a:this.a,h:this.h})},i:function(){this.c.a=this.p.a,t.Drawing.drawCircle(this.p,this.c)},o:function(t){var n=this.distanceTo(t,!0),i=n[0],e=n[1],h=n[2],a=this.e*h;if(-1===this.p.h)return this.p.x=t.x,this.p.y=t.y,!0;if(h>1)this.p.x-=i/h*a,this.p.y-=e/h*a;else{if(!(this.p.h>0))return!0;this.p.h--}return!1},u:function(){if(this.o(this.t)){var n=this.q.shift();n?(this.t.x=n.x||this.p.x,this.t.y=n.y||this.p.y,this.t.z=n.z||this.p.z,this.t.a=n.a||this.p.a,this.p.h=n.h||0):this.s?(this.p.x-=Math.sin(3.142*Math.random()),this.p.y-=Math.sin(3.142*Math.random())):this.move(new t.Point({x:this.p.x+50*Math.random()-25,y:this.p.y+50*Math.random()-25}))}d=this.p.a-this.t.a,this.p.a=Math.max(.1,this.p.a-.05*d),d=this.p.z-this.t.z,this.p.z=Math.max(1,this.p.z-.05*d)},distanceTo:function(t,n){var i=this.p.x-t.x,e=this.p.y-t.y,h=Math.sqrt(i*i+e*e);return n?[i,e,h]:h},move:function(t,n){(!n||n&&this.distanceTo(t)>1)&&this.q.push(t)},render:function(){this.u(),this.i()}},t.ShapeBuilder=function(){var n=13,i=document.createElement("canvas"),e=i.getContext("2d"),a=500;function s(){i.width=Math.floor(window.innerWidth/n)*n,i.height=Math.floor(window.innerHeight/n)*n,e.fillStyle="red",e.textBaseline="middle",e.textAlign="center"}function r(){var a=e.getImageData(0,0,i.width,i.height).data;dots=[],x=0,y=0,fx=i.width,fy=i.height,w=0,h=0;for(var s=0;s<a.length;s+=4*n)a[s+3]>0&&(dots.push(new t.Point({x:x,y:y})),w=x>w?x:w,h=y>h?y:h,fx=x<fx?x:fx,fy=y<fy?y:fy),x+=n,x>=i.width&&(x=0,y+=n,s+=4*n*i.width);return{dots:dots,w:w+fx,h:h+fy}}function o(t){e.font="bold "+t+"px Avenir, Helvetica Neue, Helvetica, Arial, sans-serif"}return s(),window.addEventListener("resize",s),{imageFile:function(n,h){var a=new Image,s=t.Drawing.getArea();a.onload=function(){e.clearRect(0,0,i.width,i.height),e.drawImage(this,0,0,.6*s.h,.6*s.h),h(r())},a.onerror=function(){h(t.ShapeBuilder.letter("What?"))},a.src=n},circle:function(t){var h=Math.max(0,t)/2;return e.clearRect(0,0,i.width,i.height),e.beginPath(),e.arc(h*n,h*n,h*n,0,2*Math.PI,!1),e.fill(),e.closePath(),r()},letter:function(t){var n;return o(a),o(Math.min(a,i.width/e.measureText(t).width*.8*a,i.height/a*(!isNaN(parseFloat(n=t))&&isFinite(n)?1:.45)*a)),e.clearRect(0,0,i.width,i.height),e.fillText(t,i.width/2,i.height/2),r()},rectangle:function(i,e){for(var h=[],a=n*i,s=n*e,r=0;r<s;r+=n)for(var o=0;o<a;o+=n)h.push(new t.Point({x:o,y:r}));return{dots:h,w:a,h:s}}}}(),t.Shape=function(){var n=[],i=0,e=0,h=0,a=0;return{shuffleIdle:function(){for(var i=t.Drawing.getArea(),e=0;e<n.length;e++)n[e].s||n[e].move({x:Math.random()*i.w,y:Math.random()*i.h})},switchShape:function(s,r){var o,c=t.Drawing.getArea();if(i=s.w,e=s.h,function(){var n=t.Drawing.getArea();h=n.w/2-i/2,a=n.h/2-e/2}(),s.dots.length>n.length){o=s.dots.length-n.length;for(var u=1;u<=o;u++)n.push(new t.Dot(c.w/2,c.h/2))}u=0;for(var f=0;s.dots.length>0;)f=Math.floor(Math.random()*s.dots.length),n[u].e=r?.25:n[u].s?.14:.11,n[u].move(new t.Point(n[u].s?{z:20*Math.random()+10,a:Math.random(),h:18}:{z:5*Math.random()+5,h:r?18:30})),n[u].s=!0,n[u].move(new t.Point({x:s.dots[f].x+h,y:s.dots[f].y+a,a:1,z:5,h:0})),s.dots=s.dots.slice(0,f).concat(s.dots.slice(f+1)),u++;for(f=u;f<n.length;f++)n[f].s&&(n[f].move(new t.Point({z:20*Math.random()+10,a:Math.random(),h:20})),n[f].s=!1,n[f].e=.04,n[f].move(new t.Point({x:Math.random()*c.w,y:Math.random()*c.h,a:.3,z:4*Math.random(),h:0})))},render:function(){for(var t=0;t<n.length;t++)n[t].render()}}}(),t.init();var n=document.getElementById("My_canvas");n.style.display="block",setTimeout((function(){n.style.display="none"}),12e3);